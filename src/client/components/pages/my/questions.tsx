import * as React from "react"
import { Link } from "react-router-dom";
import { APIQuestion } from "../../../../api-interfaces"
import Question from "../../question";
import apiFetch from "../../../api-fetch"

interface State {
    questions: APIQuestion[]
}
export default class PageMyQuestions extends React.Component<{},State> {
    constructor(props: {}) {
        super(props)
        this.state = {questions: []}
    }
    render() {
        return <div>
            <h1>質問一覧</h1>
            <Link to="/my">マイページへ</Link>
            {this.state.questions.map(q => <Question {...q} hideQuestionUser key={q._id}/>)}
        </div>
    }

    componentDidMount() {
        apiFetch("/api/web/questions").then(r => r.json()).then(questions => {
            questions = [{"_id":"5a434cef4f1f0c0001934a46","updatedAt":"2017-12-27T07:34:37.557Z","createdAt":"2017-12-27T07:34:07.785Z","questionUser":{"_id":"5a2d30b8603dca0001fd5c34","updatedAt":"2018-01-08T03:33:17.535Z","createdAt":"2017-12-10T13:03:52.500Z","avatarUrl":"https://cdn.imastodon.net/accounts/avatars/000/020/723/original/63dbbee92fda9e76.png","name":"ｼｬｰ芯P | ここしばらくの運使い果たしました","acct":"sha_shin_chyp@imastodon.net","__v":0,"url":"https://imastodon.net/@sha_shin_chyp","allAnon":false,"questionBoxName":"し゛つ゛も゛ん゛箱","description":"かみやさんちとよこやまさんち、おかむらさんちのなおさんがすき。なおすき。\r\nりんもすき。かれんもすき。みんなすき。","hostName":"imastodon.net","pushbulletEnabled":true},"user":{"_id":"5a301490d6b812000108378a","updatedAt":"2018-01-17T17:12:05.651Z","createdAt":"2017-12-12T17:40:32.848Z","url":"https://mstdn.jp/@quesdon","avatarUrl":"https://mstdn.jp/avatars/original/missing.png","name":"Quesdon 公式アカウント","acct":"quesdon@mstdn.jp","__v":0,"allAnon":true,"questionBoxName":"報告/要望箱","description":"Quesdon公式アカウントです。要望やバグ報告などはこちらにお願いします。","hostName":"mstdn.jp","pushbulletEnabled":true},"question":"来た質問を削除しようとして削除を押してそこで出てくるダイアログでOKを押しても\r\n消せないのですが考えられる原因ってなんかありますか？バグですか？","__v":0,"answer":"不具合だったので修正しました。","answeredAt":"2017-12-27T07:34:37.557Z","isNSFW":false,"likesCount":0,"isDeleted":false},{"_id":"5a4346b1c2cc480001bd91fd","updatedAt":"2017-12-27T07:26:28.313Z","createdAt":"2017-12-27T07:07:29.168Z","user":{"_id":"5a301490d6b812000108378a","updatedAt":"2018-01-17T17:12:05.651Z","createdAt":"2017-12-12T17:40:32.848Z","url":"https://mstdn.jp/@quesdon","avatarUrl":"https://mstdn.jp/avatars/original/missing.png","name":"Quesdon 公式アカウント","acct":"quesdon@mstdn.jp","__v":0,"allAnon":true,"questionBoxName":"報告/要望箱","description":"Quesdon公式アカウントです。要望やバグ報告などはこちらにお願いします。","hostName":"mstdn.jp","pushbulletEnabled":true},"question":"質問プッシュ通知もいいですが、公式垢さんからマストドンでのDM通知が来てもありがたいと思いました。もちろん連投されると嫌かもなのでデフォルトオフとかで（オンなら「名乗る」機能との兼ね合いで自分がした質問の確認的なDMも来てありがたいかも？）","__v":0,"answer":"それも考えたのですが、連合を跨いでしまうとどうしても送信/受信側両方のインスタンスに負荷をかけてしまうので、質問数が急激に増えた際にインスタンスにかけてしまう負荷などを考えた結果、断念しました。","answeredAt":"2017-12-27T07:26:28.312Z","isNSFW":false,"likesCount":0,"isDeleted":false},{"_id":"5a42e1c38a296f0001076285","updatedAt":"2017-12-27T04:06:04.143Z","createdAt":"2017-12-26T23:56:51.466Z","user":{"_id":"5a301490d6b812000108378a","updatedAt":"2018-01-17T17:12:05.651Z","createdAt":"2017-12-12T17:40:32.848Z","url":"https://mstdn.jp/@quesdon","avatarUrl":"https://mstdn.jp/avatars/original/missing.png","name":"Quesdon 公式アカウント","acct":"quesdon@mstdn.jp","__v":0,"allAnon":true,"questionBoxName":"報告/要望箱","description":"Quesdon公式アカウントです。要望やバグ報告などはこちらにお願いします。","hostName":"mstdn.jp","pushbulletEnabled":true},"question":"「私の質問箱です」に設定から自分で入力した箱の名前が入るようにしてほしいです。","__v":0,"answer":"実装しました。","answeredAt":"2017-12-27T04:06:04.142Z","isNSFW":false,"likesCount":0,"isDeleted":false},{"_id":"5a3d1af112bb000001c1a5db","updatedAt":"2017-12-27T04:05:52.911Z","createdAt":"2017-12-22T14:47:13.676Z","user":{"_id":"5a301490d6b812000108378a","updatedAt":"2018-01-17T17:12:05.651Z","createdAt":"2017-12-12T17:40:32.848Z","url":"https://mstdn.jp/@quesdon","avatarUrl":"https://mstdn.jp/avatars/original/missing.png","name":"Quesdon 公式アカウント","acct":"quesdon@mstdn.jp","__v":0,"allAnon":true,"questionBoxName":"報告/要望箱","description":"Quesdon公式アカウントです。要望やバグ報告などはこちらにお願いします。","hostName":"mstdn.jp","pushbulletEnabled":true},"question":"あと質問者のIDを表示してもらうオプションがあってもいいです、自動で＠メンション入って通知くるなら最高です。\r\nもちろんデフォルトは匿名のままでいいです","__v":0,"answer":"実装しました。ログインした状態で質問しようとすると「名乗る」というチェックボックスが出るので、それにチェックをして質問をすると誰が質問したかわかる状態で質問できます。\r\n回答する側は/my/settingsから自分宛の質問では名乗れないようにできます(質問する際に名乗らせるかどうかを選択しているので、名乗れないように設定してもすでに来ている質問は名乗っているままです)。名乗れないようにすると、ログインしていても自分の質問箱に名乗るチェックボックスが出なくなります。","answeredAt":"2017-12-27T04:05:52.908Z","isNSFW":false,"likesCount":0,"isDeleted":false},{"_id":"5a3fd575a0b3f60001136c05","updatedAt":"2017-12-26T16:04:32.000Z","createdAt":"2017-12-24T16:27:33.478Z","user":{"_id":"5a301490d6b812000108378a","updatedAt":"2018-01-17T17:12:05.651Z","createdAt":"2017-12-12T17:40:32.848Z","url":"https://mstdn.jp/@quesdon","avatarUrl":"https://mstdn.jp/avatars/original/missing.png","name":"Quesdon 公式アカウント","acct":"quesdon@mstdn.jp","__v":0,"allAnon":true,"questionBoxName":"報告/要望箱","description":"Quesdon公式アカウントです。要望やバグ報告などはこちらにお願いします。","hostName":"mstdn.jp","pushbulletEnabled":true},"question":"自分はfriends.nicoに２つのアカウント（A、Bとします）を持っているのですが、クエスドンにログインすると強制的にアカウントAにログインするので、アカウントBの質問に回答することができません。もう片方（B）のアカウントにログインするにはどうしたらいいですか？","__v":0,"answer":"friends.nico上でAのアカウントからログアウトして、Bのアカウントに「friends.nico上で」ログインした上でQuesdonにログインしてみてください","answeredAt":"2017-12-26T16:04:31.999Z","isNSFW":false,"likesCount":0,"isDeleted":false},{"_id":"5a33afc83bd8f20001aa6a8b","updatedAt":"2017-12-26T16:03:34.633Z","createdAt":"2017-12-15T11:19:36.271Z","user":{"_id":"5a301490d6b812000108378a","updatedAt":"2018-01-17T17:12:05.651Z","createdAt":"2017-12-12T17:40:32.848Z","url":"https://mstdn.jp/@quesdon","avatarUrl":"https://mstdn.jp/avatars/original/missing.png","name":"Quesdon 公式アカウント","acct":"quesdon@mstdn.jp","__v":0,"allAnon":true,"questionBoxName":"報告/要望箱","description":"Quesdon公式アカウントです。要望やバグ報告などはこちらにお願いします。","hostName":"mstdn.jp","pushbulletEnabled":true},"question":"質問が来た時の通知機能が欲しいです","__v":0,"answer":"実装しました。/my/settingsの「Pushbulletと接続して新しい質問が来た際に通知を受け取る」をクリックしてPushbulletと認証をしてください。","answeredAt":"2017-12-26T16:03:34.633Z","isNSFW":false,"likesCount":0,"isDeleted":false},{"_id":"5a33bfe63bd8f20001aa6b25","updatedAt":"2017-12-23T12:51:48.601Z","createdAt":"2017-12-15T12:28:22.547Z","user":{"_id":"5a301490d6b812000108378a","updatedAt":"2018-01-17T17:12:05.651Z","createdAt":"2017-12-12T17:40:32.848Z","url":"https://mstdn.jp/@quesdon","avatarUrl":"https://mstdn.jp/avatars/original/missing.png","name":"Quesdon 公式アカウント","acct":"quesdon@mstdn.jp","__v":0,"allAnon":true,"questionBoxName":"報告/要望箱","description":"Quesdon公式アカウントです。要望やバグ報告などはこちらにお願いします。","hostName":"mstdn.jp","pushbulletEnabled":true},"question":"公開して後悔してます、個別の回答の質問ごと削除、もしくはアカウントごと簡単にリセットさせて頂けると有難いと思いました","__v":0,"answer":"アカウントに来た質問を「回答済みのものも含めて」すべて削除する機能を実装しました。 https://quesdon.rinsuki.tk/my/settings からご利用いただけます。","answeredAt":"2017-12-23T12:51:48.601Z","isNSFW":false,"likesCount":0,"isDeleted":false},{"_id":"5a35fe1e74f3da0001237878","updatedAt":"2017-12-17T08:00:24.401Z","createdAt":"2017-12-17T05:18:22.091Z","user":{"_id":"5a301490d6b812000108378a","updatedAt":"2018-01-17T17:12:05.651Z","createdAt":"2017-12-12T17:40:32.848Z","url":"https://mstdn.jp/@quesdon","avatarUrl":"https://mstdn.jp/avatars/original/missing.png","name":"Quesdon 公式アカウント","acct":"quesdon@mstdn.jp","__v":0,"allAnon":true,"questionBoxName":"報告/要望箱","description":"Quesdon公式アカウントです。要望やバグ報告などはこちらにお願いします。","hostName":"mstdn.jp","pushbulletEnabled":true},"question":"いつも楽しんで利用させていただいてます。\r\n機能追加も早く、ありがたいです。\r\n\r\n回答空欄のまま間違って回答ボタン押してしまうと、そのまま投稿が走るようですので空欄チェックかけていただけると助かります。\r\n","__v":0,"answer":"実装しました。 質問欄/回答欄ともに、空白では送信できないようにしました。","answeredAt":"2017-12-17T08:00:24.398Z","isNSFW":false,"likesCount":0,"isDeleted":false},{"_id":"5a337226e72f01000198d9a6","updatedAt":"2017-12-15T12:55:28.269Z","createdAt":"2017-12-15T06:56:38.944Z","user":{"_id":"5a301490d6b812000108378a","updatedAt":"2018-01-17T17:12:05.651Z","createdAt":"2017-12-12T17:40:32.848Z","url":"https://mstdn.jp/@quesdon","avatarUrl":"https://mstdn.jp/avatars/original/missing.png","name":"Quesdon 公式アカウント","acct":"quesdon@mstdn.jp","__v":0,"allAnon":true,"questionBoxName":"報告/要望箱","description":"Quesdon公式アカウントです。要望やバグ報告などはこちらにお願いします。","hostName":"mstdn.jp","pushbulletEnabled":true},"question":"エロ系質問文は質問文自体も CW 内に隠せるといいなって思います。","__v":0,"answer":"実装しました。回答時にNSFWのチェックボックスを付けると、以下の配慮がなされます。\r\n- Mastodonへの回答トゥートで、質問文もCW内のみに書かれるようになる\r\n- トップやユーザーページの質問一覧で、質問を見る前にワンクッション置かれるようになる\r\n\r\n個別ページにおいてはNSFWを付けていてもURLを踏んだ瞬間表示されるのでご注意ください。","answeredAt":"2017-12-15T12:55:28.269Z","isNSFW":false,"likesCount":0,"isDeleted":false},{"_id":"5a32365de72f01000198d794","updatedAt":"2017-12-14T11:17:50.618Z","createdAt":"2017-12-14T08:29:17.036Z","user":{"_id":"5a301490d6b812000108378a","updatedAt":"2018-01-17T17:12:05.651Z","createdAt":"2017-12-12T17:40:32.848Z","url":"https://mstdn.jp/@quesdon","avatarUrl":"https://mstdn.jp/avatars/original/missing.png","name":"Quesdon 公式アカウント","acct":"quesdon@mstdn.jp","__v":0,"allAnon":true,"questionBoxName":"報告/要望箱","description":"Quesdon公式アカウントです。要望やバグ報告などはこちらにお願いします。","hostName":"mstdn.jp","pushbulletEnabled":true},"question":"結局いいね機能はつけないのでしょうか","__v":0,"answer":"バックエンドの処理は完成しているのですが、フロントエンドのUIの設計が難しく、難儀している状態です。申し訳ありませんがもうしばらくお待ちください。","answeredAt":"2017-12-14T11:17:50.618Z","isNSFW":false,"likesCount":0,"isDeleted":false},{"_id":"5a308655f934e2000134e5ac","updatedAt":"2017-12-13T05:34:51.904Z","createdAt":"2017-12-13T01:45:57.621Z","user":{"_id":"5a301490d6b812000108378a","updatedAt":"2018-01-17T17:12:05.651Z","createdAt":"2017-12-12T17:40:32.848Z","url":"https://mstdn.jp/@quesdon","avatarUrl":"https://mstdn.jp/avatars/original/missing.png","name":"Quesdon 公式アカウント","acct":"quesdon@mstdn.jp","__v":0,"allAnon":true,"questionBoxName":"報告/要望箱","description":"Quesdon公式アカウントです。要望やバグ報告などはこちらにお願いします。","hostName":"mstdn.jp","pushbulletEnabled":true},"question":"どうせcwついてるなら回答が長い時の続きはリンク先でのやつはなくして全部表示してもよいのでは？","__v":0,"answer":"あまり回答が長すぎると、省略しないとMastodon自体の文字数制限(CW警告文+内容文合わせて500文字まで)にひっかかってしまうため、省略しています。","answeredAt":"2017-12-13T05:34:51.904Z","isNSFW":false,"likesCount":0,"isDeleted":false}]
            questions = questions.map((q: APIQuestion) => {
                delete q.answeredAt
                return q
            })
            this.setState({questions})
        })
    }
}